function ApplyCouponCode(a){var b=jQuery("#gf_coupon_code_"+a).val();"undefined"!==b&&""!=b&&(jQuery("#gf_coupons_container_"+a+" #gf_coupon_spinner").show(),jQuery("#gf_coupons_container_"+a+" #gf_coupon_button").prop("disabled",!0),jQuery.post(gform_coupon_script_strings.ajaxurl,{action:"gf_apply_coupon_code",couponCode:b,existing_coupons:jQuery("#gf_coupon_codes_"+a).val(),formId:a,total:jQuery("#gf_total_no_discount_"+a).val()},function(b){var c=jQuery.parseJSON(b);if(jQuery("#gf_coupons_container_"+a+" .gf_coupon_invalid").remove(),jQuery("#gf_coupon_code_"+a).val(""),c.is_valid){window["gf_coupons"+a]=c.coupons;var d,e="",f=0;for(d in window["gf_coupons"+a])f>0&&(e+=","),e+=window["gf_coupons"+a][d].code,f++;jQuery("#gf_coupon_codes_"+a).val(e).change(),jQuery("#gf_coupons_"+a).val(jQuery.toJSON(window["gf_coupons"+a])),gformCalculateTotalPrice(a)}else jQuery("#gf_coupons_container_"+a+" #gf_coupon_info").prepend("<div class='gf_coupon_invalid'><span>"+c.invalid_reason+"</span></div>");jQuery("#gf_coupons_container_"+a+" #gf_coupon_spinner").hide()}))}function GetDiscount(a,b,c,d){var e;return c-=d,e="flat"==a?Number(b):c*Number(b/100),gform.applyFilters("gform_coupons_discount_amount",e,a,b,c,d)}function PopulateDiscountInfo(a,b){var c,d,e,f="",g=0,h=new Currency(gf_global.gf_currency_config);void 0===window["gf_coupons"+b]&&(window["gf_coupons"+b]=jQuery.evalJSON(jQuery("#gf_coupons_"+b).val()));for(c in window["gf_coupons"+b])d=window["gf_coupons"+b][c],e=GetDiscount(d.type,d.amount,a,g),g+=e,f+='<tr class="gf_coupon_item" id="gf_coupon_'+d.code+'"><td class="gf_coupon_name_container">   <a href="javascript:void(0);" onclick="DeleteCoupon(\''+d.code+"' , '"+b+'\');">(x)</a>   <span class="gf_coupon_name">'+d.name+'</span></td><td class="gf_coupon_discount_container">   <span class="gf_coupon_discount">-'+h.toMoney(e)+"</span></td></tr>";return jQuery("#gf_coupons_container_"+b+" #gf_coupon_info").html("<table>"+f+"</table>"),g}function DisableApplyButton(a){var b=0==window["new_total_"+a]||""==jQuery("#gf_coupon_code_"+a).val();b?jQuery("#gf_coupons_container_"+a+" #gf_coupon_button").prop("disabled",!0):jQuery("#gf_coupons_container_"+a+" #gf_coupon_button").prop("disabled",!1)}function gform_product_total(a,b){if(0==jQuery("#gf_coupon_code_"+a).length)return b;jQuery("#gf_total_no_discount_"+a).val(b);var c=gformIsHidden(jQuery("#gf_coupon_code_"+a))?"":jQuery("#gf_coupon_codes_"+a).val(),d=""!=c||""!=jQuery("#gf_coupons_"+a).val(),e=b;if(d){var f=PopulateDiscountInfo(b,a);e=b-f}return jQuery("#gf_coupons_container_"+a+" #gf_coupon_spinner").hide(),window["new_total_"+a]=e,DisableApplyButton(a),e}function DeleteCoupon(a,b){if(!jQuery("#gf_coupons_container_"+b+" #gf_coupon_spinner").is(":visible")){jQuery("#gf_coupons_container_"+b+" #gf_coupon_"+a).remove(),jQuery("#gf_coupons_container_"+b+" #gf_coupon_spinner").show(),jQuery("#gf_coupons_container_"+b+" #gf_coupon_button").prop("disabled",!0);var c=jQuery("#gf_coupon_codes_"+b),d=c.val().split(","),e=jQuery.inArray(a,d);-1!=e&&(d.splice(e,1),c.val(d.join(",")).change(),a in window["gf_coupons"+b]&&(delete window["gf_coupons"+b][a],jQuery("#gf_coupons_"+b).val(jQuery.toJSON(window["gf_coupons"+b]))),gformCalculateTotalPrice(b))}}gform.addFilter("gform_is_value_match",function(a,b,c){var d=jQuery("#field_"+b+"_"+c.fieldId).find("#gf_coupon_codes_"+b);return d.length?gf_matches_operation(d.val(),c.value,c.operator):a}),gform.addAction("gform_post_conditional_logic_field_action",function(a,b,c,d,e){if(!e&&"hide"==b){var f=jQuery(c),g=f.find("tr.gf_coupon_item");g.length&&(g.remove(),f.find("input[type=hidden]").val("").change())}});